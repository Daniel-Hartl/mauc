% LaTeX-Vorlage zur Erstellung einer Projektarbeit (Dokumentation eines Projekts)
% auf Basis der Vorlage für eine
% Abschlussarbeit in der Fakultät Elektrotechnik, Medien und Informatik an der OTH Amberg-Weiden
% Diese Vorlage entstand im Rahmen des Kurses "LaTeX fürs Studium"
% Aktuelle Version: v0.01
% Stand: 03.06.2023
%
% Changelog:
%
% v0.01: 03.06.2023, Anpassung der Vorlage für Projektarbeiten (article statt report, keine Titelblätter)
%
\documentclass[12pt,oneside]{article}
\usepackage[T1]{fontenc}		% Einstellungen fuer Umlaute usw.
\usepackage[utf8x]{inputenc}
\usepackage[ngerman]{babel}

\usepackage{parskip}			% Einstellungen fuer Absaetze: Abstand statt Einrueckung

\usepackage[a4paper,			% Papierformat A4
	    left=2.5cm,				% linker Rand
	    right=2.5cm,			% rechter Rand
	    top=1.5cm,				% oberer Rand
	    bottom=1.5cm,			% unter Rand
	    marginparsep=5mm,		% Abstand der Randnotizen
	    marginparwidth=10mm, 	% Breite der Randnotizen
	    headheight=7mm,			% Hoehe der Kopfzeile
	    headsep=1.2cm,			% Abstand der Kopfzeile
	    footskip=1.5cm,			% Abstand der Fusszeile
	    includeheadfoot]{geometry}

\usepackage{fancyhdr}						% Konfiguration von Kopf- und Fusszeilen
\pagestyle{fancy}							% Seitenstil 'fancy'
\fancyhf{}									% vorhandene Einstellungen loeschen
\setlength{\headwidth}{\textwidth}			% Kopf- und Fusszeile so breit wie der Haupttext
\fancyfoot[R]{\thepage} 					% Festlegung des Seitenstils: Seitenzahlen in der Fusszeile rechts
\fancyfoot[L]{\IhreArbeit}					% Kapitelnr. und -Bezeichnung in der Fusszeile links
\fancyhead[L]{\IhreGruppe: \IhrVornameEins\ \IhrNachnameEins\ \& \IhrVornameZwei\ \IhrNachnameZwei}	% Vorname und Name in der Kopfzeile links
\renewcommand{\sectionmark}[1]{	    		% Definition der Ausgabe des Kapitels
  \markboth{Abschnitt \thesection. #1}{}}
\renewcommand{\headrulewidth}{0.5pt}		% Trennlinie zwischen Kopfzeile und Haupttext
\renewcommand{\footrulewidth}{0.5pt}		% Trennlinie zwischen Haupttext und Fusszeile
\fancypagestyle{plain}{				     	% Anpassung des Seitenstils 'plain' bei Beginn neuer Kapitel
  \fancyhf{}								% Vorbelegung loeschen
  \fancyfoot[C]{\thepage}					% Seitenzeilen in der Fusszeile mittig
}

%\usepackage{amsmath}			% Pakete fuer den Mathematikmodus
%\usepackage{amssymb}
%\usepackage[intlimits]{empheq}

\usepackage[sc]{mathpazo}		% Schriftart Palatino fuer Haupttext und Mathematikmodus
\usepackage{pifont}				% zusaetzliche Symbole

% \usepackage[format=hang,		% Einstellung fuer Bildunterschriften
            % font={footnotesize},
            % labelfont={bf},
            % margin=1cm,
            % aboveskip=5pt,
            % position=bottom]{caption}

\usepackage{graphicx}							% Einbinden von Graphiken
\usepackage[svgnames,cmyk,table,hyperref]{xcolor} 	% Verwendung von Farben

\definecolor{aoenglish}{rgb}{0.0, 0.5, 0.0}
\definecolor{battleshipgrey}{rgb}{0.52, 0.52, 0.51}
\definecolor{cardinal}{rgb}{0.77, 0.12, 0.23}

%\usepackage{tikz}								% Erstellen von Grafiken
%\usetikzlibrary{positioning,arrows,plotmarks} % TikZ-Bibliotheken
%\usepackage{pgfplots}                           % Darstellung von Plots, Funktionen, Graphen usw.

%
% Weitere Pakete
%
\usepackage{listings}			% Darstellung von Quellcode
\lstloadlanguages{[ISO]C++,Java,XML,[LaTeX]TeX}
\lstset{language=C++,
	numbers = none,
	basicstyle = \small\ttfamily,
	keywordstyle = \color{blue},
	commentstyle = \color{battleshipgrey},
	stringstyle = \color{cardinal},
	columns = flexible,
	showstringspaces = false
}
%
\usepackage[square,numbers,sort]{natbib} % Zitationsstil mit Attribut lastchecked
%
%\usepackage[european, siunitx]{circuitikz}	% Darstellung von Schaltungen
%
%\usepackage{enumerate}			% Formatierung nummerierter Listen

% 
% Persoenliche Angaben
% 
\newcommand*{\IhrVornameEins}{Johannes}
\newcommand*{\IhrNachnameEins}{Grosch}
\newcommand*{\IhrVornameZwei}{Daniel}
\newcommand*{\IhrNachnameZwei}{Hartl}
\newcommand*{\IhreGruppe}{Gruppe 42}
\newcommand*{\IhrStudiengang}{Industrie-4.0-Informatik}
\newcommand*{\IhreArbeit}{Projektarbeit Mobile \& Ubiquitous Computing SoSe 2024}
\newcommand*{\IhreSchluesselwoerter}{Android, ESP32, MQTT, IoT, Pulsoximeter, MAX30100, WLAN}
\newcommand*{\IhrErstpruefer}{Prof. Dr. Ulrich Schäfer}

\newcommand{\quoteM}[1]{\glqq {1}\grqq{} }

\usepackage[bookmarks, raiselinks, pageanchor, % PDF-Einstellungen
            hyperindex, colorlinks,
            citecolor=black, linkcolor=black,
            urlcolor=black, filecolor=black,
            menucolor=black]{hyperref}
\hypersetup{pdftitle={\IhreArbeit},%
            pdfauthor={\IhrVornameEins\ \IhrNachnameEins{} \& \IhrVornameZwei\ \IhrNachnameZwei},%
            pdfsubject={\IhreGruppe},%
            pdfkeywords={\IhreSchluesselwoerter}}

%
% Beginn des Textteils
%

\begin{document}
  \thispagestyle{empty}
  \originalTeX
  \begin{center}
 	\Large
 	Ostbayerische Technische Hochschule Amberg-Weiden\\
 Fakultät Elektrotechnik, Medien und Informatik\\[.8cm]
 \large \IhrErstpruefer\\[.8cm]
 \Large \IhreArbeit\\[.8cm]
 \large \IhreGruppe: \IhrVornameEins\ \IhrNachnameEins\ \&
 \IhrVornameZwei\ \IhrNachnameZwei\\[.8cm]
 \large Studiengang \IhrStudiengang\\[.8cm]
 \today\\[2.5cm]
  \end{center}
  
  \tableofcontents

  \clearpage
  
  %
  % Einleitung
  %
  
  \section{Einleitung}
  
  Hier starten Sie mit Ihrer Beschreibung.
  
  Bitte passen Sie in der \LaTeX-Datei \texttt{projektarbeit.tex} am Anfang folgende 
  Zeilen an:
  
  Diese Literaturquellen sollten durch passende ersetzt werden: \cite{Breymann:2020,jabref,Schaefer_Spurk:2010,ct_LaTeX:2005,zotero}.
  
  Sie können die Dokumentstruktur ändern. Dies ist lediglich ein Vorschlag.
  
  Bei \href{https://www.heise.de/download/blog/Einfuehrung-in-LaTeX-3599742}{Heise (dies ist ein link)} finden Sie 
  eine Zusammenstellung, wie Sie eine \LaTeX-Entwicklungsumgebung installieren, falls Sie nicht
  \href{https://www.overleaf.com}{Overleaf} benutzen wollen.

  %
  % Projektplanung und Vorgehen
  %
  
  \section{Projektplanung und Vorgehen}
  \subsection{Serielle Kommunikation}
  \label{serialComunication}
  Die Serielle kommunikation zwischen dem ESP und dem Laptop findet mit 10Hz statt. Um unnötigen Overhead zu vermeiden findet sie in folgender, minimalistischer Synthax statt:\par
  \textbf{<Pulsschlag>;<Sauerstoffsättigung>}\par
  
  
  
  
  
  
  %
  % Implementierung
  %
  
  Hier sollten Sie auch das Protkoll/Datenformat für die serielle Kommunikation zwischen ESP32 und PC/Laptop sauber dokumentieren.
  
  \section{Implementierung}
  
  \subsection{Änderungen an der MAX30100 Bibliothek}
  Zur effizienteren Bedienung des Puls Oximeters wurde das Enumerate \quoteM{BoardType} hinzugefügt, das für den Wert 0 die Konstante ESP\_32 und für den Wert 1 LOLIN\_32 zuordnet.\par
  In der Klasse PulseOximeter selbst wurde die Signatur der Methode begin() um den Parameter \quoteM{board} modifiziert:
  \begin{lstlisting}[language=C++, caption={Signatur der begin() Methode}, captionpos=b]
bool begin(BoardType board, PulseOximeterDebuggingMode debuggingMode_);
  \end{lstlisting}
  Hierbei sind beide optional und board hat als Standardparameter ESP\_32, was den bisherigen Ablauf anstö\ss t.\par
  Sollte die Methode mit dem Parameterwert 1 oder LOLIN\_32 aufgerufen werden, so werden die Konstanten für den SDA Pin auf 0 und die für den SCL Pin auf 4 gesetzt.
  \subsection{ESP32 Code}
  Der ESP32 wurde so programmiert, dass er nach CALLBACK\_INTERVAL Millisekunden über die Serielle Schnittstelle mit 115200 Baud, wie in \ref{serialComunication} beschrieben, die Herzfrequenz und den Sauerstoffgehalt des Blutes zur weiteren Verarbeitung an den Laptop überträgt, wo diese dann weiterverarbeitet werden können.
  
  \begin{lstlisting}[language=C, caption={Quellcode des ESP32-Programms}, captionpos=b, label=srcEsp]
#include <Wire.h>
#include "MAX30100_PulseOximeter.h"

// reporting interval 100ms
#define CALLBACK_INTERVAL 100

// driver entity
PulseOximeter oximeter;

// timestap of the last output
int lastOutputTimestamp;

void setup() {
	// intit the serial interface for 115200 Baud
	Serial.begin(115200);
	while(!Serial);
	
	// try to init the oximeter and count the failed tries and delay 500ms.
	Serial.println("Begin initializing the oximeter");
	
	int initFailCounter = 0;
	
	while (!oximeter.begin(ESP_32)) {
		Serial.print("Init failed ");
		Serial.print(++initFailCounter);
		Serial.println(" times!");
		delay(500);
	}
	
	Serial.println("Oximeter initialized");
}

void loop() {
	// get values from oximeter.
	oximeter.update();
	
	// print heartrate and o2 ratio
	Serial.print(oximeter.getHeartRate());
	Serial.print(";");
	Serial.println(oximeter.getSpO2());
	
	delay(CALLBACK_INTERVAL);
}
  \end{lstlisting}
	
  %
  % Probleme und Diskussion
  %
  
  \section{Probleme und Diskussion}
  
  Sie können die Überschrift natürlich umbenennen, falls es keine Probleme gibt :-).
  
  %
  % Zusammenfassung und Ausblick
  %
  
  \section{Zusammenfassung und Ausblick}
  
  Die Literatur (für den nächsten Abschnitt) tragen Sie in die Datei \texttt{quellen.bib} ein. Diese Datei hat die BiB\TeX-Syntax (vgl. \url{https://ctan.org/pkg/bibtex}; BiB\TeX\ ist bei \href{https://www.heise.de/download/product/texstudio-62955}{\TeX studio} bzw. \href{https://www.overleaf.com}{Overleaf} dabei).
  
  Zur Literaturverwaltung verwenden Sie am besten Zotero \cite{zotero} oder JabRef \cite{jabref}. 
  
  Bei meiner \LaTeX-Installation ist der \texttt{natdin}-Style leider etwas buggy (bei \texttt{@book} wird die DOI-URL doppelt generiert, dafür fehlt sie bei \texttt{@inproceedings}). Allerdings funktioniert das
  Attribut \texttt{lastchecked} für Webseiten (Publikationstyp \texttt{@misc}).
  
  \clearpage % - bei Bedarf diesen Seitenumbruch entfernen
  
  %
  % Literatur 
  %

  \phantomsection
  \addcontentsline{toc}{section}{Literatur}
  \bibliographystyle{natdin}
  \bibliography{quellen}
  

%\include{anhang} % zum Beispiel hier die ChatGPT-Chatprotokolle einbinden (oder als extra-Datei)

\end{document}
